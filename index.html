<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Profit Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      /* Dark theme (default) */
      --bg-dark: #0a0e13;
      --bg-gradient-start: #0b0f14;
      --bg-gradient-end: #151a23;
      --card-bg: rgba(18, 24, 32, 0.6);
      --card-border: rgba(75, 179, 253, 0.15);
      --muted: #77818f;
      --text: #eaf0f6;
      --accent: #4bb3fd;
      --accent-glow: rgba(75, 179, 253, 0.3);
      --ok: #39d98a;
      --ok-glow: rgba(57, 217, 138, 0.2);
      --warn: #efaa2e;
      --warn-glow: rgba(239, 170, 46, 0.2);
      --input-bg: rgba(15, 20, 27, 0.8);
      --input-border: #243041;
      --input-focus: #4bb3fd;
      --shadow-sm: 0 2px 12px rgba(0, 0, 0, 0.4);
      --shadow-md: 0 8px 32px rgba(0, 0, 0, 0.5);
      --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.6);
    }

    /* Light theme */
    [data-theme="light"] {
      --bg-gradient-start: #f5f7fa;
      --bg-gradient-end: #e8ecf1;
      --card-bg: rgba(255, 255, 255, 0.9);
      --card-border: rgba(37, 99, 235, 0.15);
      --muted: #666666;
      --text: #1a1f2e;
      --accent: #2563eb;
      --accent-glow: rgba(37, 99, 235, 0.2);
      --ok: #22c55e;
      --ok-glow: rgba(34, 197, 94, 0.2);
      --warn: #f59e0b;
      --warn-glow: rgba(245, 158, 11, 0.2);
      --input-bg: rgba(255, 255, 255, 0.95);
      --input-border: #d0d8e0;
      --input-focus: #2563eb;
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.08);
      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.12);
    }

    [data-theme="light"] body::before {
      background: radial-gradient(circle, rgba(37, 99, 235, 0.05) 0%, transparent 70%);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    @keyframes gradient-shift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    @keyframes fade-in {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
      background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
      background-size: 200% 200%;
      animation: gradient-shift 15s ease infinite;
      color: var(--text);
      min-height: 100vh;
      padding: 32px 24px;
      position: relative;
      overflow-x: hidden;
      transition: background 0.3s ease, color 0.3s ease;
    }

    body::before {
      content: '';
      position: fixed;
      top: -50%;
      right: -50%;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(75, 179, 253, 0.08) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
      animation: fade-in 0.6s ease-out;
    }

    header {
      text-align: center;
      margin-bottom: 20px;
      animation: fade-in 0.8s ease-out;
      position: relative;
    }

    .theme-toggle {
      position: absolute;
      top: 0;
      right: 0;
      padding: 10px 18px;
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      color: var(--text);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: var(--shadow-sm);
    }

    .theme-toggle:hover {
      background: var(--input-bg);
      border-color: var(--accent);
      box-shadow: var(--shadow-md), 0 0 20px var(--accent-glow);
      transform: translateY(-2px);
    }

    .theme-icon {
      font-size: 18px;
      line-height: 1;
      transition: transform 0.3s ease;
    }

    h1 {
      font-size: 42px;
      font-weight: 700;
      margin-bottom: 12px;
      background: linear-gradient(135deg, var(--accent) 0%, #6dd5ed 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.5px;
    }

    .subtitle {
      color: var(--muted);
      font-size: 15px;
      line-height: 1.6;
      max-width: 700px;
      margin: 0 auto;
    }

    /* COPY BUTTON STYLES */
    .copy-section {
      text-align: center;
      margin-bottom: 24px;
      animation: fade-in 0.9s ease-out;
    }
    
    .copy-btn {
      background: var(--accent); 
      color: white; 
      border: none; 
      padding: 12px 32px; 
      border-radius: 12px; 
      font-size: 15px;
      font-weight: 700; 
      cursor: pointer;
      box-shadow: var(--shadow-sm);
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .copy-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md), 0 0 15px var(--accent-glow);
    }
    
    .copy-btn:active {
      transform: translateY(0);
    }

    /* CARD STYLES */
    .card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 20px;
      padding: 28px;
      box-shadow: var(--shadow-md);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      transition: all 0.3s ease;
      animation: fade-in 0.6s ease-out;
      animation-fill-mode: both;
    }

    .main-grid {
      display: grid;
      grid-template-columns: 400px 1fr;
      gap: 24px;
      margin-bottom: 24px;
    }

    @media (max-width: 1024px) {
      .main-grid {
        grid-template-columns: 1fr;
      }
    }

    .card-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 20px;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card-title::before {
      content: '';
      width: 4px;
      height: 20px;
      background: linear-gradient(180deg, var(--accent), #6dd5ed);
      border-radius: 2px;
    }

    /* MODE TOGGLE */
    .mode-toggle-container {
      background: var(--input-bg);
      border: 1px solid var(--input-border);
      border-radius: 12px;
      padding: 4px;
      display: flex;
      margin-bottom: 20px;
    }
    
    .mode-btn {
      flex: 1;
      border: none;
      background: transparent;
      color: var(--muted);
      padding: 8px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .mode-btn.active {
      background: var(--accent);
      color: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .input-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-bottom: 20px;
    }

    .input-group {
      display: flex;
      flex-direction: column;
    }
    
    .input-group.full {
      grid-column: 1 / -1;
    }
    
    .hidden {
      display: none !important;
    }

    label {
      font-size: 13px;
      font-weight: 500;
      color: var(--muted);
      margin-bottom: 8px;
      letter-spacing: 0.3px;
    }

    input[type="number"],
    select {
      width: 100%;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid var(--input-border);
      background: var(--input-bg);
      color: var(--text);
      font-size: 15px;
      font-weight: 500;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    input[type="number"]:focus,
    select:focus {
      outline: none;
      border-color: var(--input-focus);
      box-shadow: 0 0 0 3px var(--accent-glow);
    }

    /* TABLE STYLES */
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
    }

    th {
      text-align: right;
      padding: 14px 12px;
      font-size: 12px;
      font-weight: 600;
      color: var(--muted);
      text-transform: uppercase;
      border-bottom: 2px solid var(--card-border);
    }

    th:first-child { text-align: left; }
    td {
      text-align: right;
      padding: 16px 12px;
      font-size: 14px;
      border-bottom: 1px solid rgba(36, 48, 65, 0.3);
    }
    td:first-child { text-align: left; font-weight: 600; }

    .mono { font-family: monospace; font-weight: 500; }
    .ok { color: var(--ok); font-weight: 600; }
    .warn { color: var(--warn); font-weight: 600; }
    .muted { color: var(--muted); }
    .small { font-size: 12px; }

    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
      background: rgba(75, 179, 253, 0.15);
      border: 1px solid rgba(75, 179, 253, 0.3);
      color: var(--accent);
      margin: 0 4px;
    }

    .table-note {
      margin-top: 16px;
      padding: 14px;
      background: rgba(75, 179, 253, 0.05);
      border-radius: 10px;
      font-size: 13px;
      color: var(--text);
      border: 1px solid rgba(75, 179, 253, 0.1);
    }
    
    /* Fee Table specifics */
    .platform-name::before {
      content: '';
      width: 8px; height: 8px; border-radius: 50%;
      background: var(--accent);
      display: inline-block;
      margin-right: 8px;
      box-shadow: 0 0 8px var(--accent-glow);
    }

    .cell-with-arrows {
      display: flex; align-items: center; justify-content: flex-end; gap: 6px;
    }
    
    .arrow-buttons {
      display: flex; flex-direction: column; gap: 2px;
    }
    
    .arrow-btn {
      width: 20px; height: 16px;
      border: 1px solid rgba(75, 179, 253, 0.3);
      background: rgba(15, 20, 27, 0.8);
      border-radius: 4px;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      font-size: 10px; color: var(--accent);
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    .updating { animation: pulse 0.5s ease-in-out; }
    
    @media (max-width: 768px) {
      .input-grid { grid-template-columns: 1fr; }
      .theme-toggle { position: relative; margin: 0 auto 20px; display: inline-flex; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <button class="theme-toggle" id="themeToggle">
        <span class="theme-icon" id="themeIcon">üåô</span>
        <span id="themeLabel">Dark</span>
      </button>
      <h1>Profit Calculator</h1>
      <p class="subtitle">
        Optimize pricing across multiple resale platforms.
      </p>
    </header>

    <!-- FEATURE: Copy Button (Now Above Inputs) -->
    <div class="copy-section">
      <button onclick="copySummary()" class="copy-btn">
        üìã Copy Vendoo Notes
      </button>
    </div>

    <div class="main-grid">
      <div class="card">
        <h2 class="card-title">Input Parameters</h2>
        
        <!-- FEATURE: Mode Toggle -->
        <div class="mode-toggle-container">
          <button id="btnModeTarget" class="mode-btn active" onclick="setMode('target')">Target Profit</button>
          <button id="btnModeMarket" class="mode-btn" onclick="setMode('market')">Market Value</button>
        </div>

        <div class="input-grid">
          <div class="input-group">
            <label for="cogs">Cost of Goods</label>
            <input id="cogs" type="number" step="0.01" value="1.25" />
          </div>
          <div class="input-group">
            <label for="material">Material Cost</label>
            <input id="material" type="number" step="0.01" value="0.95" />
          </div>
          <div class="input-group full">
            <label for="ship">Shipping Cost (seller)</label>
            <input id="ship" type="number" step="0.01" value="6.00" />
          </div>
          
          <!-- Dynamic Inputs based on Mode -->
          <div class="input-group full" id="groupTarget">
            <label for="target">Target Profit Goal ($)</label>
            <input id="target" type="number" step="0.01" value="25.00" />
          </div>
          
          <div class="input-group full hidden" id="groupMarket">
            <label for="marketPrice">Market Value (Comps) ($)</label>
            <input id="marketPrice" type="number" step="0.01" value="40.00" />
          </div>

          <div class="input-group full" id="groupMarkup">
            <label for="markup">List Price Buffer (%)</label>
            <input id="markup" type="number" step="1" value="20" min="0" />
          </div>
        </div>
      </div>

      <div class="card">
        <h2 class="card-title">Pricing Results</h2>
        <table id="results">
          <thead>
            <tr>
              <th>Platform</th>
              <th id="colRequired">Required Price</th>
              <th id="colList">List Price</th>
              <th>Fees</th>
              <th>Net Profit</th>
              <th class="muted">Rounding</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <div class="table-note">
          <span class="badge">.99 rounding</span> Etsy, eBay ‚Ä¢ 
          <span class="badge">Whole dollars</span> Depop, Poshmark, Mercari
        </div>
      </div>
    </div>

    <div class="card fee-table-card">
      <h2 class="card-title">Platform Fee Table</h2>
      <p class="small muted" style="margin-bottom: 16px;">‚úèÔ∏è Click any cell to edit ‚Ä¢ Changes update results instantly</p>
      <table>
        <thead>
          <tr>
            <th>Platform</th>
            <th>Fee %</th>
            <th>Promo %</th>
            <th>Flat Fee $</th>
            <th>Seller Pays Ship?</th>
            <th>Default Rounding</th>
          </tr>
        </thead>
        <tbody id="feeRows"></tbody>
      </table>
    </div>
  </div>

  <script>
    // --- THEME LOGIC ---
    let currentTheme = 'dark';
    function initTheme() { setTheme(currentTheme); }
    function setTheme(theme) {
      currentTheme = theme;
      document.body.setAttribute('data-theme', theme);
      const icon = document.getElementById('themeIcon');
      const label = document.getElementById('themeLabel');
      if (theme === 'light') { icon.textContent = '‚òÄÔ∏è'; label.textContent = 'Light'; } 
      else { icon.textContent = 'üåô'; label.textContent = 'Dark'; }
    }
    document.getElementById('themeToggle').addEventListener('click', () => {
      setTheme(currentTheme === 'dark' ? 'light' : 'dark');
    });
    initTheme();

    // --- DATA & CONFIG ---
    const PLATFORMS = [
      { name: 'Etsy',     feePct: 0.095, promoPct: 0.00, flatFee: 0.45, sellerPaysShip: true,  rounding: '.99' },
      { name: 'eBay',     feePct: 0.136, promoPct: 0.12, flatFee: 0.30, sellerPaysShip: true,  rounding: '.99' },
      { name: 'Depop',    feePct: 0.033, promoPct: 0.08, flatFee: 0.45, sellerPaysShip: false, rounding: 'whole' },
      { name: 'Poshmark', feePct: 0.20,  promoPct: 0.00, flatFee: 2.95, sellerPaysShip: false, rounding: 'whole' },
      { name: 'Mercari',  feePct: 0.10,  promoPct: 0.00, flatFee: 0.00, sellerPaysShip: false, rounding: 'whole' },
    ];

    let CALC_MODE = 'target'; // 'target' or 'market'

    // --- MODE LOGIC ---
    function setMode(mode) {
      CALC_MODE = mode;
      document.getElementById('btnModeTarget').className = `mode-btn ${mode === 'target' ? 'active' : ''}`;
      document.getElementById('btnModeMarket').className = `mode-btn ${mode === 'market' ? 'active' : ''}`;
      
      if (mode === 'target') {
        document.getElementById('groupTarget').classList.remove('hidden');
        document.getElementById('groupMarkup').classList.remove('hidden');
        document.getElementById('groupMarket').classList.add('hidden');
        document.getElementById('colRequired').innerText = "Required Price";
        document.getElementById('colList').innerText = "List (Markup)";
      } else {
        document.getElementById('groupTarget').classList.add('hidden');
        document.getElementById('groupMarkup').classList.add('hidden'); // Markup irrelevant if market price is fixed
        document.getElementById('groupMarket').classList.remove('hidden');
        document.getElementById('colRequired').innerText = "Market Price";
        document.getElementById('colList').innerText = "List Price";
      }
      compute();
    }

    // --- CALCULATION HELPERS ---
    const ceilDot99 = (x) => Math.max(0.99, Math.ceil(x) - 0.01);
    const ceilWhole  = (x) => Math.ceil(x);
    const money = (n) => '$' + Number(n).toFixed(2);

    function getRoundingFor(platformName) {
      const def = PLATFORMS.find(p => p.name === platformName)?.rounding || 'whole';
      return def === '.99' ? ceilDot99 : ceilWhole;
    }

    function getFees(platform, price) {
      // Poshmark Logic
      if (platform.name === 'Poshmark') {
        if (price < 15) return 2.95;
        return price * 0.20;
      }
      // Standard Logic
      return price * (platform.feePct + platform.promoPct) + platform.flatFee;
    }

    function requiredPriceGeneric(costBaseNoFee, feePct, promoPct, flatFee) {
      const rate = feePct + promoPct;
      const denom = 1 - rate;
      return (costBaseNoFee + flatFee) / Math.max(1e-9, denom);
    }

    function requiredPricePosh(costBaseNoFee, roundingFn) {
      const rawA = costBaseNoFee + 2.95;
      const rA = roundingFn(rawA);
      const validA = rA < 15;
      const rawB = costBaseNoFee / (1 - 0.20);
      const rB = roundingFn(rawB);
      const validB = rB >= 15;

      if (validA && validB) return Math.min(rA, rB);
      if (validA) return rA;
      if (validB) return rB;
      return 15; 
    }

    // --- MAIN COMPUTE ---
    function compute() {
      // Gather Inputs
      const cogs     = parseFloat(document.getElementById('cogs').value) || 0;
      const material = parseFloat(document.getElementById('material').value) || 0;
      const ship     = parseFloat(document.getElementById('ship').value) || 0;
      const target   = parseFloat(document.getElementById('target').value) || 0;
      const markupPct = parseFloat(document.getElementById('markup').value) || 0;
      const marketPrice = parseFloat(document.getElementById('marketPrice').value) || 0;

      const tbody = document.querySelector('#results tbody');
      tbody.classList.add('updating');

      setTimeout(() => {
        tbody.innerHTML = '';

        PLATFORMS.forEach((p, index) => {
          const roundingFn = getRoundingFor(p.name);
          
          let col2_val = 0; // "Required" or "Market"
          let listPrice = 0;
          let fee = 0;
          let netProfit = 0;
          let status = 'ok';

          if (CALC_MODE === 'target') {
            // --- TARGET MODE ---
            // 1. Calculate Required Price to hit Target
            const costBase = target + cogs + material + (p.sellerPaysShip ? ship : 0);
            
            let reqRaw = 0;
            if (p.name === 'Poshmark') {
              reqRaw = requiredPricePosh(costBase, roundingFn);
            } else {
              const raw = requiredPriceGeneric(costBase, p.feePct, p.promoPct, p.flatFee);
              reqRaw = roundingFn(raw);
            }
            col2_val = reqRaw;

            // 2. Apply Markup for List Price
            const markupMult = 1 + (markupPct / 100);
            listPrice = roundingFn(reqRaw * markupMult);

            // 3. Calc Fees & Net
            fee = getFees(p, listPrice);
            const shipCost = p.sellerPaysShip ? ship : 0;
            netProfit = listPrice - fee - shipCost - cogs - material;
            status = netProfit >= target ? 'ok' : 'warn';

          } else {
            // --- MARKET MODE ---
            // 1. Use Market Price as List Price
            col2_val = marketPrice; // "Market Price" column
            listPrice = roundingFn(marketPrice); // Apply rounding to input? optional. Let's strict conform.

            // 2. Calc Fees & Net
            fee = getFees(p, listPrice);
            const shipCost = p.sellerPaysShip ? ship : 0;
            netProfit = listPrice - fee - shipCost - cogs - material;
            
            // Status: Warn if profit is negative or very low? Let's say warn if < 0
            status = netProfit > 0 ? 'ok' : 'warn';
          }

          const tr = document.createElement('tr');
          tr.style.animationDelay = `${index * 0.05}s`;
          tr.innerHTML = `
            <td><span class="platform-name">${p.name}</span></td>
            <td class="mono">${money(col2_val)}</td>
            <td class="mono">${money(listPrice)}</td>
            <td class="mono">${money(fee)}</td>
            <td class="mono ${status}">${money(netProfit)}</td>
            <td class="muted small">${p.rounding === '.99' ? '.99' : 'Whole'}</td>
          `;
          tbody.appendChild(tr);
        });

        tbody.classList.remove('updating');
      }, 50);
    }

    // --- COPY FUNCTION ---
    function copySummary() {
      const cost = document.getElementById('cogs').value || 0;
      const rows = document.querySelectorAll('#results tbody tr');
      if (rows.length < 2) return alert("Waiting for calculation...");

      // Grab eBay (row 0) and Posh (row 1) data
      // Cols: 0=Name, 1=Req/Mkt, 2=List, 3=Fee, 4=Net
      let summary = "";

      if (CALC_MODE === 'target') {
        const target = document.getElementById('target').value || 0;
        const ebayList = rows[0].cells[2].innerText;
        const poshList = rows[1].cells[2].innerText;
        summary = `Target: $${target} | Cost: $${cost} | eBay: ${ebayList} | Posh: ${poshList}`;
      } else {
        const market = document.getElementById('marketPrice').value || 0;
        const ebayNet = rows[0].cells[4].innerText;
        const poshNet = rows[1].cells[4].innerText;
        summary = `Mkt: $${market} | Cost: $${cost} | eBay Net: ${ebayNet} | Posh Net: ${poshNet}`;
      }

      navigator.clipboard.writeText(summary).then(() => {
        const btn = document.querySelector('.copy-btn');
        const originalText = btn.innerText;
        btn.innerText = "‚úÖ Copied!";
        setTimeout(() => btn.innerText = originalText, 1500);
      });
    }

    // --- PERSISTENCE & EVENTS ---
    const inputs = ['cogs', 'material', 'ship', 'target', 'markup', 'marketPrice'];
    
    // Render Fee Table (Simplified for brevity, logic same as before)
    function renderFees() {
      const feeBody = document.getElementById('feeRows');
      feeBody.innerHTML = '';
      PLATFORMS.forEach((p, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><span class="platform-name">${p.name}</span></td>
          <td><div class="cell-with-arrows"><span class="cell-value" contenteditable="true" data-idx="${index}" data-key="feePct">${(p.feePct * 100).toFixed(1)}</span></div></td>
          <td><div class="cell-with-arrows"><span class="cell-value" contenteditable="true" data-idx="${index}" data-key="promoPct">${(p.promoPct * 100).toFixed(1)}</span></div></td>
          <td><div class="cell-with-arrows"><span class="cell-value" contenteditable="true" data-idx="${index}" data-key="flatFee">${p.flatFee.toFixed(2)}</span></div></td>
          <td><select onchange="updatePlat(${index}, 'sellerPaysShip', this.value === 'yes')"><option value="yes" ${p.sellerPaysShip?'selected':''}>Yes</option><option value="no" ${!p.sellerPaysShip?'selected':''}>No</option></select></td>
          <td><select onchange="updatePlat(${index}, 'rounding', this.value)"><option value=".99" ${p.rounding==='.99'?'selected':''}>.99</option><option value="whole" ${p.rounding==='whole'?'selected':''}>Whole</option></select></td>
        `;
        feeBody.appendChild(tr);
      });
      
      // Attach listeners to editable cells
      document.querySelectorAll('.cell-value').forEach(cell => {
        cell.addEventListener('blur', (e) => {
          const idx = e.target.dataset.idx;
          const key = e.target.dataset.key;
          let val = parseFloat(e.target.innerText);
          if(key.includes('Pct')) val = val / 100;
          PLATFORMS[idx][key] = val;
          compute();
        });
      });
    }
    
    window.updatePlat = (idx, key, val) => {
      PLATFORMS[idx][key] = val;
      compute();
    }

    // Save/Load Logic
    window.addEventListener('DOMContentLoaded', () => {
      inputs.forEach(id => {
        const val = localStorage.getItem('vc_' + id);
        if (val) document.getElementById(id).value = val;
        document.getElementById(id).addEventListener('input', (e) => {
          localStorage.setItem('vc_' + id, e.target.value);
          compute();
        });
      });
      renderFees();
      compute();
    });

  </script>
</body>
</html>
